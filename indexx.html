<!DOCTYPE html>
<html lang="en" ng-app="localPulseApp">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LocalPulse - Find Local Events</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
</head>
<body ng-controller="MainController">

  <header class="navbar">
    <h1>LocalPulse</h1>
    <nav>
      <a href="#">Home</a>
      <a href="#">Events</a>
      <a href="#">About</a>
      <a href="#">Contact</a>
      <a href="./login.html">Login</a>
      <a href="./register.html">Register</a>
    </nav>
  </header>

  <main>
    <section class="hero">
      <h2>Discover the Hottest Parties & Events Near You!</h2>
      <p>Welcome <strong>{{username}}</strong>! Find energetic, trustworthy, and fun experiences tailored for youth and travelers.</p>
      <form class="search-box" ng-submit="searchEvent()">
        <input type="text" ng-model="searchText" placeholder="Search by location or event..." />
        <button type="submit">Search</button>
      </form>
    </section>

    <section class="interests">
      <h3>Explore Interests</h3>
      <div class="icons">
        <div ng-repeat="interest in interests" class="icon-item">
          <span>{{interest.icon}}</span>
          <p>{{interest.name | uppercase}}</p> <!-- 🔥 Filter #1: UPPERCASE -->
        </div>
      </div>
    </section>

    <section class="events">
      <h3>Upcoming Events</h3>
      <div class="event-grid">
        <div class="event-card" 
             ng-repeat="event in events 
                        | filter:searchText 
                        | orderBy:'title' 
                        | limitTo:5"> <!-- 🔥 Filters #2, #3, #4 -->
          <img ng-src="{{event.image}}" alt="{{event.title}}" />
          <div class="event-info">
            <h4>{{event.title}}</h4>
            <p><strong>{{event.location}}</strong></p>
            <p>{{event.date | date:'MMMM d, yyyy'}}</p> <!-- 🔥 Filter #5: DATE -->
            <a href="#" class="join-btn">Join Event</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <nav>
      <a href="#">Home</a> |
      <a href="#">Events</a> |
      <a href="#">About</a> |
      <a href="#">Contact</a> |
      <a href="#">Terms</a>
    </nav>
    <p>&copy; 2025 LocalPulse. All rights reserved.</p>
  </footer>

  <script>
var app = angular.module('localPulseApp', []);

app.controller('MainController', function($scope) {
  $scope.username = "Guest";
  $scope.searchText = "";
  $scope.userLocation = "";

  $scope.interests = [
    { icon: "🎵", name: "Music" },
    { icon: "🍽️", name: "Food" },
    { icon: "🎉", name: "Parties" },
    { icon: "💼", name: "Business" },
    { icon: "🎨", name: "Hobbies" }
  ];

  $scope.events = [
    { title: "Summer Beach Party", location: "Miami Beach, FL", date: "2024-07-20", image: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e" },
    { title: "Downtown Music Fest", location: "Central Park, NYC", date: "2024-08-10", image: "./assets/centralpartnyc.jpg" },
    { title: "Tech Innovators Meetup", location: "Silicon Valley, CA", date: "2024-09-05", image: "./assets/meetup.jpg" },
    { title: "Anna Kankatchi", location: "Chennai, Tamilnadu", date: "2025-08-10", image: "./assets/kann kaatchi.jpg" },
    { title: "Aadinaam Circus", location: "Dindigul, Tamilnadu", date: "2025-10-10", image: "./assets/circus.jpg" },
    { title: "Madurai Temple Festival", location: "Madurai, Tamilnadu", date: "2025-09-14", image: "./assets/madurai.jpg" }
  ];

  // Filter events only for the user's detected location
  $scope.locationFilter = function(event) {
    if (!$scope.userLocation) return true; // If location not yet detected, show all
    return event.location.toLowerCase().includes($scope.userLocation.toLowerCase());
  };

  $scope.searchEvent = function() {
    console.log("Searching:", $scope.searchText);
  };

  // Get accurate location using Geolocation + Nominatim
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function(position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;

        // Reverse geocoding from Nominatim
        fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
          .then(response => response.json())
          .then(data => {
            $scope.$apply(function() {
              let city = data.address.city || data.address.town || data.address.village || "";
              let state = data.address.state || "";
              $scope.userLocation = city && state ? `${city}, ${state}` : city || state;
              console.log("Detected Location:", $scope.userLocation);
            });
          })
          .catch(err => {
            console.error("Reverse geocoding error:", err);
          });
      },
      function(error) {
        console.error("Geolocation error:", error);
      }
    );
  } else {
    console.error("Geolocation is not supported by this browser.");
  }
});
</script>


</body>
</html>
